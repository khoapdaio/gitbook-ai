# 236. Lowest Common Ancestor of a Binary Tree

## Problem

[https://leetcode.com/problems/lowest-common-ancestor-of-a-binary-tree](https://leetcode.com/problems/lowest-common-ancestor-of-a-binary-tree/)

## **üìå M√¥ t·∫£ b√†i to√°n**

Cho m·ªôt c√¢y nh·ªã ph√¢n v√† hai node `p` v√† `q`, h√£y t√¨m **T·ªï ti√™n chung g·∫ßn nh·∫•t** (_Lowest Common Ancestor - LCA_) c·ªßa hai node ƒë√≥.

üìå **ƒê·ªãnh nghƒ©a:**

* LCA c·ªßa `p` v√† `q` l√† node **th·∫•p nh·∫•t** trong c√¢y c√≥ c·∫£ `p` v√† `q` l√† h·∫≠u du·ªá c·ªßa n√≥ (bao g·ªìm ch√≠nh n√≥).

üìå **R√†ng bu·ªôc:**

* `2 <= Number of nodes <= 10‚Åµ`
* Gi√° tr·ªã c·ªßa m·ªói node **l√† duy nh·∫•t**.
* `p != q`, c·∫£ `p` v√† `q` **ƒë·ªÅu t·ªìn t·∫°i trong c√¢y**.

***

## **üí° V√≠ d·ª•**

#### ‚úÖ **V√≠ d·ª• 1**

```
Input: root = [3,5,1,6,2,0,8,null,null,7,4], p = 5, q = 1
Output: 3
```

üìå **C√¢y nh·ªã ph√¢n:**

```
       3
      / \
     5   1
    / \  / \
   6   2 0  8
      / \
     7   4
```

üìå **T·ªï ti√™n chung g·∫ßn nh·∫•t c·ªßa `5` v√† `1` l√† `3`**.

***

#### ‚úÖ **V√≠ d·ª• 2**

```
Input: root = [3,5,1,6,2,0,8,null,null,7,4], p = 5, q = 4
Output: 5
```

üìå **T·ªï ti√™n chung g·∫ßn nh·∫•t c·ªßa `5` v√† `4` l√† `5` (ch√≠nh n√≥)**.

***

## **üöÄ Gi·∫£i ph√°p 1: DFS - T√¨m ki·∫øm ƒë·ªá quy**

#### üìå **√ù t∆∞·ªüng ch√≠nh:**

* Duy·ªát c√¢y b·∫±ng **DFS (post-order)**.
* N·∫øu g·∫∑p `p` ho·∫∑c `q`, tr·∫£ v·ªÅ ch√≠nh n√≥.
* N·∫øu `p` v√† `q` n·∫±m ·ªü **hai nh√°nh kh√°c nhau**, th√¨ node hi·ªán t·∫°i ch√≠nh l√† **LCA**.
* N·∫øu `p` v√† `q` n·∫±m **c√πng nh√°nh**, tr·∫£ v·ªÅ nh√°nh ch·ª©a c·∫£ hai node ƒë√≥.

***

#### ‚úÖ **Java - DFS ƒë·ªá quy**

```java
class Solution {
    public TreeNode lowestCommonAncestor(TreeNode root, TreeNode p, TreeNode q) {
        if (root == null || root == p || root == q) return root;

        TreeNode left = lowestCommonAncestor(root.left, p, q);
        TreeNode right = lowestCommonAncestor(root.right, p, q);

        if (left != null && right != null) return root; // p v√† q n·∫±m ·ªü hai ph√≠a kh√°c nhau
        return left != null ? left : right; // Tr·∫£ v·ªÅ nh√°nh ch·ª©a p ho·∫∑c q
    }
}
```

‚úÖ **√ù t∆∞·ªüng:**

* **B∆∞·ªõc 1:** N·∫øu `root` l√† `null`, `p`, ho·∫∑c `q`, th√¨ tr·∫£ v·ªÅ `root`.
* **B∆∞·ªõc 2:** Duy·ªát **tr√°i** v√† **ph·∫£i** ƒë·ªÉ t√¨m `p` v√† `q`.
* **B∆∞·ªõc 3:**
  * N·∫øu `p` v√† `q` n·∫±m ·ªü **hai nh√°nh kh√°c nhau**, `root` ch√≠nh l√† LCA.
  * N·∫øu ch·ªâ c√≥ m·ªôt nh√°nh ch·ª©a `p` ho·∫∑c `q`, tr·∫£ v·ªÅ nh√°nh ƒë√≥.

‚è≥ **ƒê·ªô ph·ª©c t·∫°p:**

* **Th·ªùi gian:** `O(n)`, duy·ªát to√†n b·ªô c√¢y m·ªôt l·∫ßn.
* **Kh√¥ng gian:** `O(h)`, v·ªõi `h` l√† chi·ªÅu cao c·ªßa c√¢y (t·ªá nh·∫•t `O(n)`).

***

## **üöÄ Gi·∫£i ph√°p 2: Duy·ªát c√¢y + B·∫£ng Hash (L∆∞u cha c·ªßa m·ªói node)**

#### üìå **√ù t∆∞·ªüng ch√≠nh:**

* Duy·ªát c√¢y m·ªôt l·∫ßn ƒë·ªÉ **l∆∞u cha c·ªßa m·ªói node** v√†o **HashMap**.
* Sau ƒë√≥, d√πng **HashSet** ƒë·ªÉ t√¨m LCA b·∫±ng c√°ch ki·ªÉm tra t·ªï ti√™n c·ªßa `p` v√† `q`.

***

#### ‚úÖ **Java - Duy·ªát c√¢y + HashMap**

```java
import java.util.*;

class Solution {
    public TreeNode lowestCommonAncestor(TreeNode root, TreeNode p, TreeNode q) {
        Map<TreeNode, TreeNode> parentMap = new HashMap<>();
        Deque<TreeNode> stack = new ArrayDeque<>();
        parentMap.put(root, null);
        stack.push(root);

        while (!parentMap.containsKey(p) || !parentMap.containsKey(q)) {
            TreeNode node = stack.pop();
            if (node.left != null) {
                parentMap.put(node.left, node);
                stack.push(node.left);
            }
            if (node.right != null) {
                parentMap.put(node.right, node);
                stack.push(node.right);
            }
        }

        Set<TreeNode> ancestors = new HashSet<>();
        while (p != null) {
            ancestors.add(p);
            p = parentMap.get(p);
        }

        while (!ancestors.contains(q)) {
            q = parentMap.get(q);
        }

        return q;
    }
}
```

‚úÖ **√ù t∆∞·ªüng:**

* **B∆∞·ªõc 1:** Duy·ªát c√¢y b·∫±ng DFS ƒë·ªÉ l∆∞u cha c·ªßa m·ªói node v√†o `parentMap`.
* **B∆∞·ªõc 2:** D√πng `HashSet` ƒë·ªÉ l∆∞u t·ªï ti√™n c·ªßa `p`.
* **B∆∞·ªõc 3:** Duy·ªát t·ªï ti√™n c·ªßa `q`, n·∫øu t√¨m th·∫•y trong `HashSet`, ƒë√≥ l√† LCA.

‚è≥ **ƒê·ªô ph·ª©c t·∫°p:**

* **Th·ªùi gian:** `O(n)`, v√¨ duy·ªát c√¢y **hai l·∫ßn** (`O(n) + O(n)`).
* **Kh√¥ng gian:** `O(n)`, do l∆∞u **parentMap** v√† **HashSet**.

***

## **üöÄ Gi·∫£i ph√°p 3: BFS (Duy·ªát theo t·∫ßng)**

#### üìå **√ù t∆∞·ªüng ch√≠nh:**

* Duy·ªát c√¢y theo t·∫ßng (BFS) ƒë·ªÉ l∆∞u **cha c·ªßa m·ªói node**.
* Sau ƒë√≥ t√¨m LCA gi·ªëng **Gi·∫£i ph√°p 2**.

***

#### ‚úÖ **Java - BFS**

```java
import java.util.*;

class Solution {
    public TreeNode lowestCommonAncestor(TreeNode root, TreeNode p, TreeNode q) {
        Map<TreeNode, TreeNode> parentMap = new HashMap<>();
        Queue<TreeNode> queue = new LinkedList<>();
        parentMap.put(root, null);
        queue.offer(root);

        while (!parentMap.containsKey(p) || !parentMap.containsKey(q)) {
            TreeNode node = queue.poll();
            if (node.left != null) {
                parentMap.put(node.left, node);
                queue.offer(node.left);
            }
            if (node.right != null) {
                parentMap.put(node.right, node);
                queue.offer(node.right);
            }
        }

        Set<TreeNode> ancestors = new HashSet<>();
        while (p != null) {
            ancestors.add(p);
            p = parentMap.get(p);
        }

        while (!ancestors.contains(q)) {
            q = parentMap.get(q);
        }

        return q;
    }
}
```

‚úÖ **√ù t∆∞·ªüng:**

* **B∆∞·ªõc 1:** Duy·ªát theo t·∫ßng (BFS) ƒë·ªÉ l∆∞u cha c·ªßa m·ªói node v√†o `parentMap`.
* **B∆∞·ªõc 2:** D√πng `HashSet` ƒë·ªÉ l∆∞u t·ªï ti√™n c·ªßa `p`.
* **B∆∞·ªõc 3:** Duy·ªát t·ªï ti√™n c·ªßa `q`, t√¨m LCA.

## ‚è≥ **ƒê·ªô ph·ª©c t·∫°p:**

* **Th·ªùi gian:** `O(n)`, v√¨ duy·ªát c√¢y hai l·∫ßn.
* **Kh√¥ng gian:** `O(n)`, do l∆∞u `parentMap` v√† `HashSet`.

***

## **üìå T·ªïng k·∫øt**

| Ph∆∞∆°ng ph√°p       | Th·ªùi gian | Kh√¥ng gian |
| ----------------- | --------- | ---------- |
| **DFS ƒë·ªá quy**    | `O(n)`    | `O(h)`     |
| **DFS + HashMap** | `O(n)`    | `O(n)`     |
| **BFS + HashMap** | `O(n)`    | `O(n)`     |

‚úÖ **DFS ƒë·ªá quy l√† c√°ch t·ªëi ∆∞u nh·∫•t** v√¨ kh√¥ng c·∫ßn d√πng `HashMap`.

