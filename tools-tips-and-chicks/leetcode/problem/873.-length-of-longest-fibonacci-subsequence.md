# 873. Length of Longest Fibonacci Subsequence

## **â“ Problem:**

ğŸ”— [873. Length of Longest Fibonacci Subsequence](https://leetcode.com/problems/length-of-longest-fibonacci-subsequence)

## **ğŸ“ MÃ´ táº£:**

Cho má»™t máº£ng sá»‘ nguyÃªn `arr` **khÃ´ng trÃ¹ng láº·p**, hÃ£y tÃ¬m Ä‘á»™ dÃ i dÃ i nháº¥t cá»§a má»™t dÃ£y con cÃ³ dáº¡ng **chuá»—i Fibonacci**.

Má»™t dÃ£y Fibonacci há»£p lá»‡ thá»a mÃ£n Ä‘iá»u kiá»‡n:

```
arr[i] + arr[j] = arr[k], vá»›i i < j < k.
```

Náº¿u khÃ´ng cÃ³ dÃ£y con nÃ o há»£p lá»‡, tráº£ vá» `0`.

***

## **ğŸ’¡ VÃ­ dá»¥:**

#### **âœ… VÃ­ dá»¥ 1:**

**Input:**

```
arr = [1,2,3,4,5,6,7,8]
```

**Output:**

```
5
```

**Giáº£i thÃ­ch:**\
DÃ£y Fibonacci dÃ i nháº¥t lÃ  `[1,2,3,5,8]` vá»›i Ä‘á»™ dÃ i **5**.

***

#### **âœ… VÃ­ dá»¥ 2:**

**Input:**

```
arr = [1,3,7,11,12,14,18]
```

**Output:**

```
3
```

**Giáº£i thÃ­ch:**\
DÃ£y Fibonacci dÃ i nháº¥t lÃ  `[1,11,12]` hoáº·c `[3,11,14]` vá»›i Ä‘á»™ dÃ i **3**.

***

## **ğŸš€ Giáº£i phÃ¡p**

#### **ğŸ”¹ Ã tÆ°á»Ÿng (Dynamic Programming + HashMap)**

1. **DÃ¹ng HashMap (`index`)** Ä‘á»ƒ lÆ°u vá»‹ trÃ­ cá»§a tá»«ng pháº§n tá»­ trong `arr`.
2. **DÃ¹ng báº£ng `dp[i][j]`**, trong Ä‘Ã³ `dp[i][j]` lÃ  Ä‘á»™ dÃ i dÃ i nháº¥t cá»§a dÃ£y Fibonacci káº¿t thÃºc táº¡i `arr[i]` vÃ  `arr[j]`.
3. **Cáº­p nháº­t `dp[i][j]`** dá»±a vÃ o pháº§n tá»­ trÆ°á»›c Ä‘Ã³ (`arr[k]`):
   * Náº¿u tá»“n táº¡i `k` sao cho `arr[k] + arr[i] = arr[j]`, thÃ¬ **cÃ³ thá»ƒ má»Ÿ rá»™ng dÃ£y Fibonacci**.
   * Khi Ä‘Ã³, `dp[i][j] = dp[k][i] + 1` (náº¿u tá»“n táº¡i `dp[k][i]`, ngÆ°á»£c láº¡i báº¯t Ä‘áº§u tá»« 2).

***

## **ğŸ“œ Code**

{% tabs %}
{% tab title="C++" %}
```cpp
#include <vector>
#include <unordered_map>
using namespace std;

class Solution {
public:
    int lenLongestFibSubseq(vector<int>& arr) {
        int n = arr.size(), maxLen = 0;
        unordered_map<int, int> index;
        vector<vector<int>> dp(n, vector<int>(n, 2)); // dp[i][j] lÆ°u Ä‘á»™ dÃ i Fibonacci

        // LÆ°u vá»‹ trÃ­ cá»§a tá»«ng pháº§n tá»­
        for (int i = 0; i < n; i++) {
            index[arr[i]] = i;
        }

        // Duyá»‡t tá»«ng cáº·p (i, j)
        for (int i = 0; i < n; i++) {
            for (int j = i + 1; j < n; j++) {
                int k = index.count(arr[j] - arr[i]) ? index[arr[j] - arr[i]] : -1;
                if (k >= 0 && k < i) {
                    dp[i][j] = dp[k][i] + 1; // Cáº­p nháº­t Ä‘á»™ dÃ i Fibonacci
                }
                maxLen = max(maxLen, dp[i][j]); // Cáº­p nháº­t káº¿t quáº£ lá»›n nháº¥t
            }
        }

        return maxLen > 2 ? maxLen : 0; // Náº¿u khÃ´ng cÃ³ dÃ£y Fibonacci há»£p lá»‡, tráº£ vá» 0
    }
};
```
{% endtab %}

{% tab title="Java" %}
```java
import java.util.*;

class Solution {
    public int lenLongestFibSubseq(int[] arr) {
        int n = arr.length;
        Map<Integer, Integer> index = new HashMap<>();
        int[][] dp = new int[n][n]; // dp[i][j] lÆ°u Ä‘á»™ dÃ i Fibonacci káº¿t thÃºc táº¡i i, j
        int maxLen = 0;

        // LÆ°u vá»‹ trÃ­ cá»§a tá»«ng pháº§n tá»­
        for (int i = 0; i < n; i++) {
            index.put(arr[i], i);
        }

        // Duyá»‡t tá»«ng cáº·p (i, j)
        for (int i = 0; i < n; i++) {
            for (int j = i + 1; j < n; j++) {
                int k = index.getOrDefault(arr[j] - arr[i], -1); // Kiá»ƒm tra pháº§n tá»­ trÆ°á»›c Ä‘Ã³
                if (k >= 0 && k < i) { 
                    dp[i][j] = dp[k][i] + 1; // Cáº­p nháº­t Ä‘á»™ dÃ i Fibonacci
                } else {
                    dp[i][j] = 2; // Khá»Ÿi táº¡o Ä‘á»™ dÃ i máº·c Ä‘á»‹nh
                }
                maxLen = Math.max(maxLen, dp[i][j]); // Cáº­p nháº­t káº¿t quáº£ lá»›n nháº¥t
            }
        }

        return maxLen > 2 ? maxLen : 0; // Náº¿u khÃ´ng cÃ³ dÃ£y Fibonacci há»£p lá»‡, tráº£ vá» 0
    }
}
```
{% endtab %}

{% tab title="Python" %}
```python
class Solution:
    def lenLongestFibSubseq(self, arr: List[int]) -> int:
        index = {num: i for i, num in enumerate(arr)}  # LÆ°u vá»‹ trÃ­ tá»«ng pháº§n tá»­
        n = len(arr)
        dp = [[2] * n for _ in range(n)]  # dp[i][j] lÆ°u Ä‘á»™ dÃ i Fibonacci
        max_len = 0

        # Duyá»‡t tá»«ng cáº·p (i, j)
        for i in range(n):
            for j in range(i + 1, n):
                k = index.get(arr[j] - arr[i], -1)  # Kiá»ƒm tra pháº§n tá»­ trÆ°á»›c Ä‘Ã³
                if k >= 0 and k < i:
                    dp[i][j] = dp[k][i] + 1  # Cáº­p nháº­t Ä‘á»™ dÃ i Fibonacci
                max_len = max(max_len, dp[i][j])  # Cáº­p nháº­t káº¿t quáº£ lá»›n nháº¥t

        return max_len if max_len > 2 else 0  # Náº¿u khÃ´ng cÃ³ dÃ£y Fibonacci há»£p lá»‡, tráº£ vá» 0
```
{% endtab %}
{% endtabs %}

***

## **ğŸ¯ Äiá»ƒm chÃ­nh**

âœ… **Sá»­ dá»¥ng HashMap (`index`) Ä‘á»ƒ truy xuáº¥t nhanh vá»‹ trÃ­ cá»§a sá»‘ trÆ°á»›c Ä‘Ã³.**\
âœ… **DÃ¹ng `dp[i][j]` Ä‘á»ƒ lÆ°u Ä‘á»™ dÃ i cá»§a dÃ£y Fibonacci káº¿t thÃºc táº¡i `i, j`.**\
âœ… **Duyá»‡t tá»«ng cáº·p `(i, j)` vÃ  cáº­p nháº­t `dp[k][i]`.**\
âœ… **Chá»‰ xÃ©t `k < i` Ä‘á»ƒ Ä‘áº£m báº£o dÃ£y tÄƒng dáº§n.**

***

## **â³ Äá»™ phá»©c táº¡p thuáº­t toÃ¡n**

* **Thá»i gian:** `O(n^2)`, do duyá»‡t tá»«ng cáº·p `(i, j)`.
* **KhÃ´ng gian:** `O(n^2)`, lÆ°u `dp[i][j]`.

***

## **ğŸ“Œ Tá»•ng káº¿t**

* **DÃ¹ng HashMap Ä‘á»ƒ tÃ¬m vá»‹ trÃ­ sá»‘ trÆ°á»›c Ä‘Ã³ trong `O(1)`.**
* **DÃ¹ng Dynamic Programming (`dp[i][j]`) Ä‘á»ƒ tá»‘i Æ°u tÃ­nh toÃ¡n.**
* **Äá»™ phá»©c táº¡p `O(n^2)`, ráº¥t tá»‘t cho `n â‰¤ 1000`.** ğŸš€
